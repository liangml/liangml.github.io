<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Nginx - LEON BLOG</title><meta name=author content="Leon">
<meta name=description content='请求方法限制 1 2 3 if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 501; } try_files 1 2 3 location / { try_files $uri $uri/ /index.html; } next.js 1 2 3 location / { try_files $uri $uri.html $uri/ /index.html; } 443 force ssl 1 2 3 4 5 if ($ssl_protocol = "") { return 302 https://$host$request_uri; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 redirect; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 permanent; } 499 1 2 3 4 5 proxy_ignore_client_abort on; # 确定在客户端关闭连接时是否应关闭与代理服务器的连接，而不在等待响应 proxy_read_timeout 600; proxy_send_timeout 600; # 如果超时(默认60s)，Nginx 会主动断开连接，记录504 log format 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 log_format main escape=json &#39;{ "time_local": "$time_local", &#39; &#39;"remote_user": "$remote_user", &#39; &#39;"remote_addr": "$remote_addr", &#39; &#39;"http_referer": "$http_referer", &#39; &#39;"request": "$request", &#39; &#39;"method": "$request_method", &#39; &#39;"url_path": "$request_uri", &#39; &#39;"request_body": "$request_body", &#39; &#39;"status": $status, &#39; &#39;"level": "$level",&#39; &#39;"body_bytes_sent": $body_bytes_sent, &#39; &#39;"http_user_agent": "$http_user_agent", &#39; &#39;"http_host": "$http_host", &#39; &#39;"http_requestid": "$http_requestid", &#39; &#39;"http_authorization": "$http_authorization", &#39; &#39;"business": "ngx_access-$host", &#39; &#39;"http_x_forwarded_for": "$http_x_forwarded_for", &#39; &#39;"upstream_addr": "$upstream_addr",&#39; &#39;"trace_id": "$trace_id",&#39; &#39;"upstream_response_time": "$upstream_response_timer",&#39; &#39;"ssl_protocol": "$ssl_protocol",&#39; &#39;"request_time": $request_time&#39; &#39; }&#39;; 跨域 1 2 3 add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods *; add_header Access-Control-Allow-Credentials true; 上传文件 1 2 # nginx client_max_body_size 1024m; 1 2 3 4 5 6 7 8 9 # php file_uploads on 是否允许通过HTTP上传文件的开关。 默认为ON即是开upload_tmp_dir – 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹 upload_max_filesize 8m 望文生意，即允许上传文件大小的最大值。默认为2M post_max_size 8m 指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M # 针对网络不好配置 max_execution_time 600 每个PHP页面运行的最大时间值(秒)，默认30秒 max_input_time 600 每个PHP页面接收数据所需的最大时间，默认60秒 memory_limit 8m 每个PHP页面所吃掉的最大内存，默认8M proxy 1 2 3 4 5 6 7 8 location ~ .*\.(js|css)?$ { expires 12h; proxy_pass http://xxx; } location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)?$ { expires 12h; proxy_pass http://xxx; } exsample http 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 upstream xxx.cn { server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; check interval=1000 rise=2 fall=3 timeout=5000 type=http default_down=false; check_http_send "GET /ping HTTP/1.0\\r\\n\\r\\n"; check_http_expect_alive http_2xx http_3xx; } server { listen	80; server_name xxx.cn; index index.html index.htm; access_log /var/log/nginx/xxx.cn.access.log main; error_log /var/log/nginx/xxx.cn.error.log warn; location ~ ^/NginxStatus/ { stub_status on; access_log on; } location / { proxy_redirect off ; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_connect_timeout 600; proxy_send_timeout 600; proxy_read_timeout 600; proxy_ignore_client_abort on; proxy_buffer_size 1600k; proxy_buffers 4 3200k; proxy_busy_buffers_size 6400k; proxy_temp_file_write_size 6400k; proxy_max_temp_file_size 128m; proxy_next_upstream error timeout invalid_header http_500 http_503 http_404; proxy_pass	http://xxx.cn; } } php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; ssl_certificate /usr/local/openresty/nginx/conf/ssl/xxx.com.pem; ssl_certificate_key /usr/local/openresty/nginx/conf/ssl/xxx.com.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1; ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256; ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256; ssl_conf_command Options PrioritizeChaCha; ssl_prefer_server_ciphers on; ssl_session_timeout 10m; ssl_session_cache shared:SSL:10m; ssl_buffer_size 2k; add_header Strict-Transport-Security max-age=15768000; ssl_stapling on; ssl_stapling_verify on; server_name xxx; access_log /var/log/xxx.log combined; index index.html index.htm index.php; root xxx_path; if ($ssl_protocol = "") { return 302 https://$host$request_uri; } location ~ [^/]\\.php(/|$) { #fastcgi_pass remote_php_ip:9000; fastcgi_pass unix:/dev/shm/php-cgi.sock; fastcgi_index index.php; include fastcgi.conf; } location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ { expires 30d; access_log off; } location ~ .*\\.(js|css)?$ { expires 7d; access_log off; } location ~ /(\\.user\\.ini|\\.ht|\\.git|\\.svn|\\.project|LICENSE|README\\.md|\\.env) { deny all; } location /.well-known { allow all; } default_server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 手动生成本地ssl公私钥 openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt # 增加default_server cat << &#39;EOF&#39; > /etc/nginx/sites-available/000_default server { listen 80 default_server; listen 443 ssl default_server; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; server_name _; return 444; access_log /var/log/nginx/000_default.access.log; error_log /var/log/nginx/000_default.error.log; } EOF # reload nginx nginx -t nginx -s reload # 查看日志，检查其他域名是否正常 tailf /var/log/nginx/000_default.access.log '><meta name=keywords content='nginx'><meta itemprop=name content="Nginx"><meta itemprop=description content='请求方法限制 1 2 3 if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 501; } try_files 1 2 3 location / { try_files $uri $uri/ /index.html; } next.js 1 2 3 location / { try_files $uri $uri.html $uri/ /index.html; } 443 force ssl 1 2 3 4 5 if ($ssl_protocol = "") { return 302 https://$host$request_uri; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 redirect; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 permanent; } 499 1 2 3 4 5 proxy_ignore_client_abort on; # 确定在客户端关闭连接时是否应关闭与代理服务器的连接，而不在等待响应 proxy_read_timeout 600; proxy_send_timeout 600; # 如果超时(默认60s)，Nginx 会主动断开连接，记录504 log format 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 log_format main escape=json &#39;{ "time_local": "$time_local", &#39; &#39;"remote_user": "$remote_user", &#39; &#39;"remote_addr": "$remote_addr", &#39; &#39;"http_referer": "$http_referer", &#39; &#39;"request": "$request", &#39; &#39;"method": "$request_method", &#39; &#39;"url_path": "$request_uri", &#39; &#39;"request_body": "$request_body", &#39; &#39;"status": $status, &#39; &#39;"level": "$level",&#39; &#39;"body_bytes_sent": $body_bytes_sent, &#39; &#39;"http_user_agent": "$http_user_agent", &#39; &#39;"http_host": "$http_host", &#39; &#39;"http_requestid": "$http_requestid", &#39; &#39;"http_authorization": "$http_authorization", &#39; &#39;"business": "ngx_access-$host", &#39; &#39;"http_x_forwarded_for": "$http_x_forwarded_for", &#39; &#39;"upstream_addr": "$upstream_addr",&#39; &#39;"trace_id": "$trace_id",&#39; &#39;"upstream_response_time": "$upstream_response_timer",&#39; &#39;"ssl_protocol": "$ssl_protocol",&#39; &#39;"request_time": $request_time&#39; &#39; }&#39;; 跨域 1 2 3 add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods *; add_header Access-Control-Allow-Credentials true; 上传文件 1 2 # nginx client_max_body_size 1024m; 1 2 3 4 5 6 7 8 9 # php file_uploads on 是否允许通过HTTP上传文件的开关。 默认为ON即是开upload_tmp_dir – 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹 upload_max_filesize 8m 望文生意，即允许上传文件大小的最大值。默认为2M post_max_size 8m 指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M # 针对网络不好配置 max_execution_time 600 每个PHP页面运行的最大时间值(秒)，默认30秒 max_input_time 600 每个PHP页面接收数据所需的最大时间，默认60秒 memory_limit 8m 每个PHP页面所吃掉的最大内存，默认8M proxy 1 2 3 4 5 6 7 8 location ~ .*\.(js|css)?$ { expires 12h; proxy_pass http://xxx; } location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)?$ { expires 12h; proxy_pass http://xxx; } exsample http 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 upstream xxx.cn { server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; check interval=1000 rise=2 fall=3 timeout=5000 type=http default_down=false; check_http_send "GET /ping HTTP/1.0\\r\\n\\r\\n"; check_http_expect_alive http_2xx http_3xx; } server { listen	80; server_name xxx.cn; index index.html index.htm; access_log /var/log/nginx/xxx.cn.access.log main; error_log /var/log/nginx/xxx.cn.error.log warn; location ~ ^/NginxStatus/ { stub_status on; access_log on; } location / { proxy_redirect off ; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_connect_timeout 600; proxy_send_timeout 600; proxy_read_timeout 600; proxy_ignore_client_abort on; proxy_buffer_size 1600k; proxy_buffers 4 3200k; proxy_busy_buffers_size 6400k; proxy_temp_file_write_size 6400k; proxy_max_temp_file_size 128m; proxy_next_upstream error timeout invalid_header http_500 http_503 http_404; proxy_pass	http://xxx.cn; } } php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; ssl_certificate /usr/local/openresty/nginx/conf/ssl/xxx.com.pem; ssl_certificate_key /usr/local/openresty/nginx/conf/ssl/xxx.com.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1; ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256; ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256; ssl_conf_command Options PrioritizeChaCha; ssl_prefer_server_ciphers on; ssl_session_timeout 10m; ssl_session_cache shared:SSL:10m; ssl_buffer_size 2k; add_header Strict-Transport-Security max-age=15768000; ssl_stapling on; ssl_stapling_verify on; server_name xxx; access_log /var/log/xxx.log combined; index index.html index.htm index.php; root xxx_path; if ($ssl_protocol = "") { return 302 https://$host$request_uri; } location ~ [^/]\\.php(/|$) { #fastcgi_pass remote_php_ip:9000; fastcgi_pass unix:/dev/shm/php-cgi.sock; fastcgi_index index.php; include fastcgi.conf; } location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ { expires 30d; access_log off; } location ~ .*\\.(js|css)?$ { expires 7d; access_log off; } location ~ /(\\.user\\.ini|\\.ht|\\.git|\\.svn|\\.project|LICENSE|README\\.md|\\.env) { deny all; } location /.well-known { allow all; } default_server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 手动生成本地ssl公私钥 openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt # 增加default_server cat << &#39;EOF&#39; > /etc/nginx/sites-available/000_default server { listen 80 default_server; listen 443 ssl default_server; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; server_name _; return 444; access_log /var/log/nginx/000_default.access.log; error_log /var/log/nginx/000_default.error.log; } EOF # reload nginx nginx -t nginx -s reload # 查看日志，检查其他域名是否正常 tailf /var/log/nginx/000_default.access.log'><meta itemprop=datePublished content="2024-10-15T19:25:10+08:00"><meta itemprop=dateModified content="2024-10-15T19:25:10+08:00"><meta itemprop=wordCount content="954"><meta itemprop=image content="https://liangml.github.io/logo.png"><meta itemprop=keywords content="Nginx"><meta property="og:url" content="https://liangml.github.io/posts/nginx/"><meta property="og:site_name" content="LEON BLOG"><meta property="og:title" content="Nginx"><meta property="og:description" content='请求方法限制 1 2 3 if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 501; } try_files 1 2 3 location / { try_files $uri $uri/ /index.html; } next.js 1 2 3 location / { try_files $uri $uri.html $uri/ /index.html; } 443 force ssl 1 2 3 4 5 if ($ssl_protocol = "") { return 302 https://$host$request_uri; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 redirect; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 permanent; } 499 1 2 3 4 5 proxy_ignore_client_abort on; # 确定在客户端关闭连接时是否应关闭与代理服务器的连接，而不在等待响应 proxy_read_timeout 600; proxy_send_timeout 600; # 如果超时(默认60s)，Nginx 会主动断开连接，记录504 log format 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 log_format main escape=json &#39;{ "time_local": "$time_local", &#39; &#39;"remote_user": "$remote_user", &#39; &#39;"remote_addr": "$remote_addr", &#39; &#39;"http_referer": "$http_referer", &#39; &#39;"request": "$request", &#39; &#39;"method": "$request_method", &#39; &#39;"url_path": "$request_uri", &#39; &#39;"request_body": "$request_body", &#39; &#39;"status": $status, &#39; &#39;"level": "$level",&#39; &#39;"body_bytes_sent": $body_bytes_sent, &#39; &#39;"http_user_agent": "$http_user_agent", &#39; &#39;"http_host": "$http_host", &#39; &#39;"http_requestid": "$http_requestid", &#39; &#39;"http_authorization": "$http_authorization", &#39; &#39;"business": "ngx_access-$host", &#39; &#39;"http_x_forwarded_for": "$http_x_forwarded_for", &#39; &#39;"upstream_addr": "$upstream_addr",&#39; &#39;"trace_id": "$trace_id",&#39; &#39;"upstream_response_time": "$upstream_response_timer",&#39; &#39;"ssl_protocol": "$ssl_protocol",&#39; &#39;"request_time": $request_time&#39; &#39; }&#39;; 跨域 1 2 3 add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods *; add_header Access-Control-Allow-Credentials true; 上传文件 1 2 # nginx client_max_body_size 1024m; 1 2 3 4 5 6 7 8 9 # php file_uploads on 是否允许通过HTTP上传文件的开关。 默认为ON即是开upload_tmp_dir – 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹 upload_max_filesize 8m 望文生意，即允许上传文件大小的最大值。默认为2M post_max_size 8m 指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M # 针对网络不好配置 max_execution_time 600 每个PHP页面运行的最大时间值(秒)，默认30秒 max_input_time 600 每个PHP页面接收数据所需的最大时间，默认60秒 memory_limit 8m 每个PHP页面所吃掉的最大内存，默认8M proxy 1 2 3 4 5 6 7 8 location ~ .*\.(js|css)?$ { expires 12h; proxy_pass http://xxx; } location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)?$ { expires 12h; proxy_pass http://xxx; } exsample http 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 upstream xxx.cn { server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; check interval=1000 rise=2 fall=3 timeout=5000 type=http default_down=false; check_http_send "GET /ping HTTP/1.0\\r\\n\\r\\n"; check_http_expect_alive http_2xx http_3xx; } server { listen	80; server_name xxx.cn; index index.html index.htm; access_log /var/log/nginx/xxx.cn.access.log main; error_log /var/log/nginx/xxx.cn.error.log warn; location ~ ^/NginxStatus/ { stub_status on; access_log on; } location / { proxy_redirect off ; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_connect_timeout 600; proxy_send_timeout 600; proxy_read_timeout 600; proxy_ignore_client_abort on; proxy_buffer_size 1600k; proxy_buffers 4 3200k; proxy_busy_buffers_size 6400k; proxy_temp_file_write_size 6400k; proxy_max_temp_file_size 128m; proxy_next_upstream error timeout invalid_header http_500 http_503 http_404; proxy_pass	http://xxx.cn; } } php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; ssl_certificate /usr/local/openresty/nginx/conf/ssl/xxx.com.pem; ssl_certificate_key /usr/local/openresty/nginx/conf/ssl/xxx.com.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1; ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256; ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256; ssl_conf_command Options PrioritizeChaCha; ssl_prefer_server_ciphers on; ssl_session_timeout 10m; ssl_session_cache shared:SSL:10m; ssl_buffer_size 2k; add_header Strict-Transport-Security max-age=15768000; ssl_stapling on; ssl_stapling_verify on; server_name xxx; access_log /var/log/xxx.log combined; index index.html index.htm index.php; root xxx_path; if ($ssl_protocol = "") { return 302 https://$host$request_uri; } location ~ [^/]\\.php(/|$) { #fastcgi_pass remote_php_ip:9000; fastcgi_pass unix:/dev/shm/php-cgi.sock; fastcgi_index index.php; include fastcgi.conf; } location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ { expires 30d; access_log off; } location ~ .*\\.(js|css)?$ { expires 7d; access_log off; } location ~ /(\\.user\\.ini|\\.ht|\\.git|\\.svn|\\.project|LICENSE|README\\.md|\\.env) { deny all; } location /.well-known { allow all; } default_server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 手动生成本地ssl公私钥 openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt # 增加default_server cat << &#39;EOF&#39; > /etc/nginx/sites-available/000_default server { listen 80 default_server; listen 443 ssl default_server; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; server_name _; return 444; access_log /var/log/nginx/000_default.access.log; error_log /var/log/nginx/000_default.error.log; } EOF # reload nginx nginx -t nginx -s reload # 查看日志，检查其他域名是否正常 tailf /var/log/nginx/000_default.access.log'><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-15T19:25:10+08:00"><meta property="article:modified_time" content="2024-10-15T19:25:10+08:00"><meta property="article:tag" content="Nginx"><meta property="og:image" content="https://liangml.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://liangml.github.io/logo.png"><meta name=twitter:title content="Nginx"><meta name=twitter:description content='请求方法限制 1 2 3 if ($request_method !~ ^(GET|HEAD|POST)$ ) { return 501; } try_files 1 2 3 location / { try_files $uri $uri/ /index.html; } next.js 1 2 3 location / { try_files $uri $uri.html $uri/ /index.html; } 443 force ssl 1 2 3 4 5 if ($ssl_protocol = "") { return 302 https://$host$request_uri; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 redirect; } or if ($server_port !~ 443) { rewrite ^(.*)$ https://$host$1 permanent; } 499 1 2 3 4 5 proxy_ignore_client_abort on; # 确定在客户端关闭连接时是否应关闭与代理服务器的连接，而不在等待响应 proxy_read_timeout 600; proxy_send_timeout 600; # 如果超时(默认60s)，Nginx 会主动断开连接，记录504 log format 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 log_format main escape=json &#39;{ "time_local": "$time_local", &#39; &#39;"remote_user": "$remote_user", &#39; &#39;"remote_addr": "$remote_addr", &#39; &#39;"http_referer": "$http_referer", &#39; &#39;"request": "$request", &#39; &#39;"method": "$request_method", &#39; &#39;"url_path": "$request_uri", &#39; &#39;"request_body": "$request_body", &#39; &#39;"status": $status, &#39; &#39;"level": "$level",&#39; &#39;"body_bytes_sent": $body_bytes_sent, &#39; &#39;"http_user_agent": "$http_user_agent", &#39; &#39;"http_host": "$http_host", &#39; &#39;"http_requestid": "$http_requestid", &#39; &#39;"http_authorization": "$http_authorization", &#39; &#39;"business": "ngx_access-$host", &#39; &#39;"http_x_forwarded_for": "$http_x_forwarded_for", &#39; &#39;"upstream_addr": "$upstream_addr",&#39; &#39;"trace_id": "$trace_id",&#39; &#39;"upstream_response_time": "$upstream_response_timer",&#39; &#39;"ssl_protocol": "$ssl_protocol",&#39; &#39;"request_time": $request_time&#39; &#39; }&#39;; 跨域 1 2 3 add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods *; add_header Access-Control-Allow-Credentials true; 上传文件 1 2 # nginx client_max_body_size 1024m; 1 2 3 4 5 6 7 8 9 # php file_uploads on 是否允许通过HTTP上传文件的开关。 默认为ON即是开upload_tmp_dir – 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹 upload_max_filesize 8m 望文生意，即允许上传文件大小的最大值。默认为2M post_max_size 8m 指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M # 针对网络不好配置 max_execution_time 600 每个PHP页面运行的最大时间值(秒)，默认30秒 max_input_time 600 每个PHP页面接收数据所需的最大时间，默认60秒 memory_limit 8m 每个PHP页面所吃掉的最大内存，默认8M proxy 1 2 3 4 5 6 7 8 location ~ .*\.(js|css)?$ { expires 12h; proxy_pass http://xxx; } location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)?$ { expires 12h; proxy_pass http://xxx; } exsample http 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 upstream xxx.cn { server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; server 10.x:3000 weight=10 max_fails=3 fail_timeout=3s; check interval=1000 rise=2 fall=3 timeout=5000 type=http default_down=false; check_http_send "GET /ping HTTP/1.0\\r\\n\\r\\n"; check_http_expect_alive http_2xx http_3xx; } server { listen	80; server_name xxx.cn; index index.html index.htm; access_log /var/log/nginx/xxx.cn.access.log main; error_log /var/log/nginx/xxx.cn.error.log warn; location ~ ^/NginxStatus/ { stub_status on; access_log on; } location / { proxy_redirect off ; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_connect_timeout 600; proxy_send_timeout 600; proxy_read_timeout 600; proxy_ignore_client_abort on; proxy_buffer_size 1600k; proxy_buffers 4 3200k; proxy_busy_buffers_size 6400k; proxy_temp_file_write_size 6400k; proxy_max_temp_file_size 128m; proxy_next_upstream error timeout invalid_header http_500 http_503 http_404; proxy_pass	http://xxx.cn; } } php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; ssl_certificate /usr/local/openresty/nginx/conf/ssl/xxx.com.pem; ssl_certificate_key /usr/local/openresty/nginx/conf/ssl/xxx.com.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1; ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256; ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256; ssl_conf_command Options PrioritizeChaCha; ssl_prefer_server_ciphers on; ssl_session_timeout 10m; ssl_session_cache shared:SSL:10m; ssl_buffer_size 2k; add_header Strict-Transport-Security max-age=15768000; ssl_stapling on; ssl_stapling_verify on; server_name xxx; access_log /var/log/xxx.log combined; index index.html index.htm index.php; root xxx_path; if ($ssl_protocol = "") { return 302 https://$host$request_uri; } location ~ [^/]\\.php(/|$) { #fastcgi_pass remote_php_ip:9000; fastcgi_pass unix:/dev/shm/php-cgi.sock; fastcgi_index index.php; include fastcgi.conf; } location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico)$ { expires 30d; access_log off; } location ~ .*\\.(js|css)?$ { expires 7d; access_log off; } location ~ /(\\.user\\.ini|\\.ht|\\.git|\\.svn|\\.project|LICENSE|README\\.md|\\.env) { deny all; } location /.well-known { allow all; } default_server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 # 手动生成本地ssl公私钥 openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt # 增加default_server cat << &#39;EOF&#39; > /etc/nginx/sites-available/000_default server { listen 80 default_server; listen 443 ssl default_server; ssl_certificate /etc/nginx/ssl/nginx.crt; ssl_certificate_key /etc/nginx/ssl/nginx.key; server_name _; return 444; access_log /var/log/nginx/000_default.access.log; error_log /var/log/nginx/000_default.error.log; } EOF # reload nginx nginx -t nginx -s reload # 查看日志，检查其他域名是否正常 tailf /var/log/nginx/000_default.access.log'><meta name=application-name content="Leon的小站"><meta name=apple-mobile-web-app-title content="Leon的小站"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://liangml.github.io/posts/nginx/ title="Nginx - LEON BLOG"><link rel=prev type=text/html href=https://liangml.github.io/posts/minio/ title=Minio><link rel=next type=text/html href=https://liangml.github.io/posts/openvpncommunity/ title=OpenvpnCommunity><link rel=alternate type=text/markdown href=https://liangml.github.io/posts/nginx/index.md title="Nginx - LEON BLOG"><link rel=stylesheet href=/css/style.min.999fc44987aa81959766023190aed3b84fc2e373f70cb60d0bf85ba5d7d93d79.css integrity="sha256-mZ/ESYeqgZWXZgIxkK7TuE/C43P3DLYNC/hbpdfZPXk="><link rel=preload href=/lib/fontawesome-free/all.min.320d572dfb844e7152480b7b62374236c4896ccca3ac9d69bb03f3bc2034acb8.css integrity="sha256-Mg1XLfuETnFSSAt7YjdCNsSJbMyjrJ1puwPzvCA0rLg=" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.320d572dfb844e7152480b7b62374236c4896ccca3ac9d69bb03f3bc2034acb8.css integrity="sha256-Mg1XLfuETnFSSAt7YjdCNsSJbMyjrJ1puwPzvCA0rLg="></noscript><link rel=preload href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Nginx","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/liangml.github.io\/posts\/nginx\/"},"image":["https:\/\/liangml.github.io\/favicon.ico"],"genre":"posts","keywords":"nginx","wordcount":954,"url":"https:\/\/liangml.github.io\/posts\/nginx\/","datePublished":"2024-10-15T19:25:10+08:00","dateModified":"2024-10-15T19:25:10+08:00","publisher":{"@type":"Organization","name":"Leehow","logo":"https:\/\/liangml.github.io\/logo.png"},"author":{"@type":"Person","name":"Leon"},"description":""}</script><script src=/js/head/color-scheme.min.15fc6d693c4ea1331dfdbe98e8c76402340195b0a3b4047378cec39b7c827bfa.js integrity="sha256-FfxtaTxOoTMd/b6Y6MdkAjQBlbCjtARzeM7Dm3yCe/o="></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="LEON BLOG"><img loading=lazy src=/logo.png alt="LEON BLOG" data-title="LEON BLOG" width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Kylin Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/archives/><i class="fa-solid fa-feather fa-fw fa-sm" aria-hidden=true></i> 文章</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="LEON BLOG"><img loading=lazy src=/logo.png alt="LEON BLOG" data-title="LEON BLOG" width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Kylin Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/archives/><i class="fa-solid fa-feather fa-fw fa-sm" aria-hidden=true></i> 文章</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details collection-details open"><div class="details-summary collection-summary"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i>
<span class=collection-name data-collections=合集>Services</span>
<span class=collection-count>8</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content collection-content"><nav><ul class=collection-list><li class=collection-item><a href=/posts/tomcat/ title=Tomcat>Tomcat</a></li><li class=collection-item><a href=/posts/apisix/ title=Apisix>Apisix</a></li><li class=collection-item><a href=/posts/gitlab/ title=Gitlab>Gitlab</a></li><li class=collection-item><a href=/posts/kafka/ title=Kafka>Kafka</a></li><li class=collection-item><a href=/posts/kibana/ title=Kibana>Kibana</a></li><li class=collection-item><a href=/posts/minio/ title=Minio>Minio</a></li><li class=collection-item><span class=active title=Nginx>Nginx</span></li><li class=collection-item><a href=/posts/openvpncommunity/ title=OpenvpnCommunity>OpenvpnCommunity</a></li></ul><div class=collection-nav-simple><a href=/posts/minio/ class=collection-nav-item rel=prev title=Minio><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i></a><span class=text-secondary>7/8</span><a href=/posts/openvpncommunity/ class=collection-nav-item rel=next title=OpenvpnCommunity><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></nav></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Nginx</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/nginx/ class=post-category title="分类 - Nginx"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Nginx</a> 和 <a href=/collections/services/ class=post-collection title="合集 - Services"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Services</a></span></div><div class=post-meta-line><span title="发布于 2024-10-15 19:25:10"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2024-10-15>2024-10-15</time></span>&nbsp;<span title="954 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 1000 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 2 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=Nginx><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#请求方法限制>请求方法限制</a></li><li><a href=#try_files>try_files</a></li><li><a href=#443-force-ssl>443 force ssl</a></li><li><a href=#499>499</a></li><li><a href=#log-format>log format</a></li><li><a href=#跨域>跨域</a></li><li><a href=#上传文件>上传文件</a></li><li><a href=#proxy>proxy</a></li><li><a href=#exsample>exsample</a><ul><li><a href=#http>http</a></li><li><a href=#php>php</a></li></ul></li><li><a href=#default_server>default_server</a></li></ul></nav></div></div><div class=content id=content><h2 id=请求方法限制 class=heading-element><span>请求方法限制</span>
<a href=#%e8%af%b7%e6%b1%82%e6%96%b9%e6%b3%95%e9%99%90%e5%88%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=nv>$request_method</span> !~ ^<span class=o>(</span>GET<span class=p>|</span>HEAD<span class=p>|</span>POST<span class=o>)</span>$ <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> 501<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=try_files class=heading-element><span>try_files</span>
<a href=#try_files class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    try_files <span class=nv>$uri</span> <span class=nv>$uri</span>/ /index.html<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><hr><ul><li>next.js</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    try_files <span class=nv>$uri</span> <span class=nv>$uri</span>.html <span class=nv>$uri</span>/ /index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=443-force-ssl class=heading-element><span>443 force ssl</span>
<a href=#443-force-ssl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$ssl_protocol</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=m>302</span> https://<span class=nv>$host$request_uri</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>or
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$server_port</span> !~ 443<span class=o>)</span> <span class=o>{</span> rewrite ^<span class=o>(</span>.*<span class=o>)</span>$ https://<span class=nv>$host$1</span> redirect<span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>or
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$server_port</span> !~ 443<span class=o>)</span> <span class=o>{</span> rewrite ^<span class=o>(</span>.*<span class=o>)</span>$ https://<span class=nv>$host$1</span> permanent<span class=p>;</span> <span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=499 class=heading-element><span>499</span>
<a href=#499 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>proxy_ignore_client_abort on<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 确定在客户端关闭连接时是否应关闭与代理服务器的连接，而不在等待响应</span>
</span></span><span class=line><span class=cl>proxy_read_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>proxy_send_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 如果超时(默认60s)，Nginx 会主动断开连接，记录504</span></span></span></code></pre></td></tr></table></div></div><h2 id=log-format class=heading-element><span>log format</span>
<a href=#log-format class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>log_format main  <span class=nv>escape</span><span class=o>=</span>json <span class=s1>&#39;{ &#34;time_local&#34;: &#34;$time_local&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;remote_user&#34;: &#34;$remote_user&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;remote_addr&#34;: &#34;$remote_addr&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_referer&#34;: &#34;$http_referer&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;request&#34;: &#34;$request&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;method&#34;: &#34;$request_method&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;url_path&#34;: &#34;$request_uri&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;request_body&#34;: &#34;$request_body&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;status&#34;: $status, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;level&#34;: &#34;$level&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;body_bytes_sent&#34;: $body_bytes_sent, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_user_agent&#34;: &#34;$http_user_agent&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_host&#34;: &#34;$http_host&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_requestid&#34;: &#34;$http_requestid&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_authorization&#34;: &#34;$http_authorization&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;business&#34;: &#34;ngx_access-$host&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_x_forwarded_for&#34;: &#34;$http_x_forwarded_for&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;upstream_addr&#34;: &#34;$upstream_addr&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;trace_id&#34;: &#34;$trace_id&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;upstream_response_time&#34;: &#34;$upstream_response_timer&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;ssl_protocol&#34;: &#34;$ssl_protocol&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;request_time&#34;: $request_time&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39; }&#39;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h2 id=跨域 class=heading-element><span>跨域</span>
<a href=#%e8%b7%a8%e5%9f%9f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>add_header Access-Control-Allow-Origin *<span class=p>;</span>
</span></span><span class=line><span class=cl>add_header Access-Control-Allow-Methods *<span class=p>;</span>
</span></span><span class=line><span class=cl>add_header Access-Control-Allow-Credentials true<span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h2 id=上传文件 class=heading-element><span>上传文件</span>
<a href=#%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># nginx
</span></span><span class=line><span class=cl>client_max_body_size 1024m;</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># php
</span></span><span class=line><span class=cl>file_uploads on        是否允许通过HTTP上传文件的开关。
</span></span><span class=line><span class=cl>默认为ON即是开upload_tmp_dir – 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹
</span></span><span class=line><span class=cl>upload_max_filesize 8m 望文生意，即允许上传文件大小的最大值。默认为2M
</span></span><span class=line><span class=cl>post_max_size 8m       指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M
</span></span><span class=line><span class=cl># 针对网络不好配置
</span></span><span class=line><span class=cl>max_execution_time 600  每个PHP页面运行的最大时间值(秒)，默认30秒
</span></span><span class=line><span class=cl>max_input_time 600      每个PHP页面接收数据所需的最大时间，默认60秒
</span></span><span class=line><span class=cl>memory_limit 8m         每个PHP页面所吃掉的最大内存，默认8M</span></span></code></pre></td></tr></table></div></div><h2 id=proxy class=heading-element><span>proxy</span>
<a href=#proxy class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>location ~ .*\.(js|css)?$ {
</span></span><span class=line><span class=cl>	expires 12h;
</span></span><span class=line><span class=cl>	proxy_pass http://xxx;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)?$ {
</span></span><span class=line><span class=cl>	expires 12h;
</span></span><span class=line><span class=cl>	proxy_pass http://xxx;
</span></span><span class=line><span class=cl>}</span></span></code></pre></td></tr></table></div></div><h2 id=exsample class=heading-element><span>exsample</span>
<a href=#exsample class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><h3 id=http class=heading-element><span>http</span>
<a href=#http class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>upstream xxx.cn <span class=o>{</span>
</span></span><span class=line><span class=cl>	server  10.x:3000  <span class=nv>weight</span><span class=o>=</span><span class=m>10</span> <span class=nv>max_fails</span><span class=o>=</span><span class=m>3</span> <span class=nv>fail_timeout</span><span class=o>=</span>3s<span class=p>;</span>
</span></span><span class=line><span class=cl>	server  10.x:3000  <span class=nv>weight</span><span class=o>=</span><span class=m>10</span> <span class=nv>max_fails</span><span class=o>=</span><span class=m>3</span> <span class=nv>fail_timeout</span><span class=o>=</span>3s<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 	check <span class=nv>interval</span><span class=o>=</span><span class=m>1000</span> <span class=nv>rise</span><span class=o>=</span><span class=m>2</span> <span class=nv>fall</span><span class=o>=</span><span class=m>3</span> <span class=nv>timeout</span><span class=o>=</span><span class=m>5000</span> <span class=nv>type</span><span class=o>=</span>http <span class=nv>default_down</span><span class=o>=</span>false<span class=p>;</span>
</span></span><span class=line><span class=cl> 	check_http_send <span class=s2>&#34;GET /ping HTTP/1.0\\r\\n\\r\\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 	check_http_expect_alive http_2xx http_3xx<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>	listen	80<span class=p>;</span>
</span></span><span class=line><span class=cl>	server_name  xxx.cn<span class=p>;</span>
</span></span><span class=line><span class=cl>	index index.html index.htm<span class=p>;</span>
</span></span><span class=line><span class=cl>	access_log  /var/log/nginx/xxx.cn.access.log  main<span class=p>;</span>
</span></span><span class=line><span class=cl>	error_log   /var/log/nginx/xxx.cn.error.log warn<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	location ~ ^/NginxStatus/ <span class=o>{</span>
</span></span><span class=line><span class=cl>			stub_status on<span class=p>;</span>
</span></span><span class=line><span class=cl>			access_log on<span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	location / <span class=o>{</span>
</span></span><span class=line><span class=cl>		proxy_redirect off <span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header Host <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header X-Real-IP <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header REMOTE-HOST <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header X-Forwarded-For <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_connect_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_send_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_read_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_ignore_client_abort on<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_buffer_size 1600k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_buffers <span class=m>4</span> 3200k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_busy_buffers_size 6400k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_temp_file_write_size 6400k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_max_temp_file_size 128m<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_next_upstream error timeout invalid_header http_500 http_503 http_404<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_pass	http://xxx.cn<span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=php class=heading-element><span>php</span>
<a href=#php class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>listen <span class=o>[</span>::<span class=o>]</span>:80<span class=p>;</span>
</span></span><span class=line><span class=cl>listen <span class=m>443</span> ssl http2<span class=p>;</span>
</span></span><span class=line><span class=cl>listen <span class=o>[</span>::<span class=o>]</span>:443 ssl http2<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_certificate /usr/local/openresty/nginx/conf/ssl/xxx.com.pem<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_certificate_key /usr/local/openresty/nginx/conf/ssl/xxx.com.key<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_protocols TLSv1.2 TLSv1.3<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_conf_command Options PrioritizeChaCha<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_prefer_server_ciphers on<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_session_timeout 10m<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_session_cache shared:SSL:10m<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_buffer_size 2k<span class=p>;</span>
</span></span><span class=line><span class=cl>add_header Strict-Transport-Security max-age<span class=o>=</span>15768000<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_stapling on<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_stapling_verify on<span class=p>;</span>
</span></span><span class=line><span class=cl>server_name xxx<span class=p>;</span>
</span></span><span class=line><span class=cl>access_log /var/log/xxx.log combined<span class=p>;</span>
</span></span><span class=line><span class=cl>index index.html index.htm index.php<span class=p>;</span>
</span></span><span class=line><span class=cl>root xxx_path<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$ssl_protocol</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=m>302</span> https://<span class=nv>$host$request_uri</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ <span class=o>[</span>^/<span class=o>]</span><span class=se>\\</span>.php<span class=o>(</span>/<span class=p>|</span>$<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>#fastcgi_pass remote_php_ip:9000;</span>
</span></span><span class=line><span class=cl>  fastcgi_pass unix:/dev/shm/php-cgi.sock<span class=p>;</span>
</span></span><span class=line><span class=cl>  fastcgi_index index.php<span class=p>;</span>
</span></span><span class=line><span class=cl>  include fastcgi.conf<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ .*<span class=se>\\</span>.<span class=o>(</span>gif<span class=p>|</span>jpg<span class=p>|</span>jpeg<span class=p>|</span>png<span class=p>|</span>bmp<span class=p>|</span>swf<span class=p>|</span>flv<span class=p>|</span>mp4<span class=p>|</span>ico<span class=o>)</span>$ <span class=o>{</span>
</span></span><span class=line><span class=cl>  expires 30d<span class=p>;</span>
</span></span><span class=line><span class=cl>  access_log off<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ .*<span class=se>\\</span>.<span class=o>(</span>js<span class=p>|</span>css<span class=o>)</span>?$ <span class=o>{</span>
</span></span><span class=line><span class=cl>  expires 7d<span class=p>;</span>
</span></span><span class=line><span class=cl>  access_log off<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ /<span class=o>(</span><span class=se>\\</span>.user<span class=se>\\</span>.ini<span class=p>|</span><span class=se>\\</span>.ht<span class=p>|</span><span class=se>\\</span>.git<span class=p>|</span><span class=se>\\</span>.svn<span class=p>|</span><span class=se>\\</span>.project<span class=p>|</span>LICENSE<span class=p>|</span>README<span class=se>\\</span>.md<span class=p>|</span><span class=se>\\</span>.env<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  deny all<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location /.well-known <span class=o>{</span>
</span></span><span class=line><span class=cl>  allow all<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h2 id=default_server class=heading-element><span>default_server</span>
<a href=#default_server class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># 手动生成本地ssl公私钥
</span></span><span class=line><span class=cl>openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 增加default_server
</span></span><span class=line><span class=cl>cat &lt;&lt; &#39;EOF&#39; &gt; /etc/nginx/sites-available/000_default
</span></span><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen 80 default_server;
</span></span><span class=line><span class=cl>    listen 443 ssl default_server;
</span></span><span class=line><span class=cl>    ssl_certificate        /etc/nginx/ssl/nginx.crt;
</span></span><span class=line><span class=cl>    ssl_certificate_key    /etc/nginx/ssl/nginx.key;
</span></span><span class=line><span class=cl>    server_name _;
</span></span><span class=line><span class=cl>    return 444;
</span></span><span class=line><span class=cl>    access_log /var/log/nginx/000_default.access.log;
</span></span><span class=line><span class=cl>    error_log /var/log/nginx/000_default.error.log;
</span></span><span class=line><span class=cl>} 
</span></span><span class=line><span class=cl>EOF
</span></span><span class=line><span class=cl># reload nginx
</span></span><span class=line><span class=cl>nginx -t
</span></span><span class=line><span class=cl>nginx -s reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 查看日志，检查其他域名是否正常
</span></span><span class=line><span class=cl>tailf /var/log/nginx/000_default.access.log</span></span></code></pre></td></tr></table></div></div></div><div class=collection-card><div class="collection-title text-secondary">收录于 <a href=/collections/services/><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> <span>合集・Services</span></span></a> 8</div><div class=collection-nav><a href=/posts/minio/ class=collection-nav-item rel=prev title=Minio><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i><span>Minio</span>
</a><a href=/posts/openvpncommunity/ class=collection-nav-item rel=next title=OpenvpnCommunity><span>OpenvpnCommunity</span><i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2024-10-15 19:25:10">更新于 2024-10-15&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/nginx/ class=post-tag title="标签 - Nginx">Nginx</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/minio/ class=post-nav-item rel=prev title=Minio><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Minio</a><a href=/posts/openvpncommunity/ class=post-nav-item rel=next title=OpenvpnCommunity>OpenvpnCommunity<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=liangml/liangml.github.io data-repo-id=MDEwOlJlcG9zaXRvcnkxMTkwNDA5MzU: data-category=Announcements data-category-id=DIC_kwDOBxhrp84CjXpD data-mapping=pathname data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.140.0"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.16-f66dc32e"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/>Leon</a></span><span class="license footer-divider"><a rel:"license external nofollow noopener noreferrer" href:"https://creativecommons.org/licenses/by-nc/4.0/" target:"_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/liangml title="在 GitHub 上查看源代码" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.120f067ebd6f322339e2ccccd7e87e334d7c7ea5b2bd553f325f2ae3c3ae6fe8.css integrity="sha256-Eg8Gfr1vMiM54szM1+h+M018fqWyvVU/Ml8q48Oub+g="><link rel=preload href=/lib/katex/katex.min.7e5db7914b97e596a36c1abb67ccc7f174f8bb71d38c9a88c55b262ed1737f97.css integrity="sha256-fl23kUuX5ZajbBq7Z8zH8XT4u3HTjJqIxVsmLtFzf5c=" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.7e5db7914b97e596a36c1abb67ccc7f174f8bb71d38c9a88c55b262ed1737f97.css integrity="sha256-fl23kUuX5ZajbBq7Z8zH8XT4u3HTjJqIxVsmLtFzf5c="></noscript><script src=/lib/autocomplete/autocomplete.min.ae2da1bd62c6469ee27770ad1cddf2e8296d8a7f6d85b091463e5200c5e320af.js integrity="sha256-ri2hvWLGRp7id3CtHN3y6Cltin9thbCRRj5SAMXjIK8=" defer></script><script src=/lib/fuse/fuse.min.c57339c3fa16b1d69d9a6b46749a8139ef8d4fc9bbfe48144ff897aa7d4222ec.js integrity="sha256-xXM5w/oWsdadmmtGdJqBOe+NT8m7/kgUT/iXqn1CIuw=" defer></script><script src=/lib/lightgallery/lightgallery.min.7de2854e7954105f2b91ff5983749c4e3c7af51e05aae279f8a5d66994a85777.js integrity="sha256-feKFTnlUEF8rkf9Zg3ScTjx69R4FquJ5+KXWaZSoV3c=" defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.4fbc3ec1878e90348b71b3594d8ef27c4f10a1a4c6d5e74948d0ee59018fd87c.js integrity="sha256-T7w+wYeOkDSLcbNZTY7yfE8QoaTG1edJSNDuWQGP2Hw=" defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.821a2adb8005511c0ad9ef6f395c1b74beacc2da194cd13a4ac43d341246e085.js integrity="sha256-ghoq24AFURwK2e9vOVwbdL6swtoZTNE6SsQ9NBJG4IU=" defer></script><script src=/lib/sharer/sharer.min.ba5171a78670b031914e623431a33a3d73c1ea9897e552ba73bc2c2da7c777b9.js integrity="sha256-ulFxp4ZwsDGRTmI0MaM6PXPB6piX5VK6c7wsLafHd7k=" async defer></script><script src=/lib/katex/katex.min.9f45307c5794ed247a0d095f3a62e52ef2215a67b2327203a7fd919959ae79d1.js integrity="sha256-n0UwfFeU7SR6DQlfOmLlLvIhWmeyMnIDp/2RmVmuedE=" defer></script><script src=/lib/katex/auto-render.min.7b57d427ac6270677daf8d8380ded2cc73336f9149a167b8e1fe0d6ef66604ae.js integrity="sha256-e1fUJ6xicGd9r42DgN7SzHMzb5FJoWe44f4NbvZmBK4=" defer></script><script src=/lib/katex/copy-tex.min.07770af90943a1de1a1010794bc78c6a7346d46d48fb63e35cc76ba76b827604.js integrity="sha256-B3cK+QlDod4aEBB5S8eManNG1G1I+2PjXMdrp2uCdgQ=" defer></script><script src=/lib/katex/mhchem.min.f0ca03df194b8c3d6017ff455db6a0ef98857905663fa311a6cded788b15340b.js integrity="sha256-8MoD3xlLjD1gF/9FXbag75iFeQVmP6MRps3teIsVNAs=" defer></script><script src=/lib/pangu/pangu.min.8feca3e7a71d118d82c2456d1b2cf5f1f3726c51a930627c2711b7192c8edbe2.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" defer></script><script src=https://vercount.one/js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark",lightTheme:"light",origin:"https://giscus.app"}},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2018-02-06T11:15:22+08:00",version:"v0.3.16-f66dc32e"}</script><script src=/js/theme.min.0daa504da430d5723626cca1801d04ac125316adbe008489bd4ebe37d7bd9a01.js integrity="sha256-DapQTaQw1XI2JsyhgB0ErBJTFq2+AISJvU6+N9e9mgE=" defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TDTX88VL0X",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-TDTX88VL0X" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0efb33ce4bda317225be7158a8517fd0",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>