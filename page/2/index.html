<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta name=generator content="Hugo 0.140.1"><meta name=theme content='FixIt v0.3.16-f66dc32e'><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>LEON BLOG</title><meta name=author content="Leon">
<meta name=description content="运维小站，分享些技术经验。"><meta name=keywords content='Hugo,FixIt'><meta itemprop=name content="LEON BLOG"><meta itemprop=description content="运维小站，分享些技术经验。"><meta itemprop=datePublished content="2024-11-22T15:31:08+08:00"><meta itemprop=dateModified content="2024-11-22T15:31:08+08:00"><meta itemprop=image content="https://liangml.github.io/logo.png"><meta property="og:url" content="https://liangml.github.io/"><meta property="og:site_name" content="LEON BLOG"><meta property="og:title" content="LEON BLOG"><meta property="og:description" content="运维小站，分享些技术经验。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="website"><meta property="og:image" content="https://liangml.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://liangml.github.io/logo.png"><meta name=twitter:title content="LEON BLOG"><meta name=twitter:description content="运维小站，分享些技术经验。"><meta name=application-name content="Leon的小站"><meta name=apple-mobile-web-app-title content="Leon的小站"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://liangml.github.io/ title="LEON BLOG"><link rel=alternate type=application/rss+xml href=https://liangml.github.io/index.xml title="LEON BLOG"><link rel=search type=application/json href=https://liangml.github.io/search.json title="LEON BLOG"><link rel=stylesheet href=/css/style.min.999fc44987aa81959766023190aed3b84fc2e373f70cb60d0bf85ba5d7d93d79.css integrity="sha256-mZ/ESYeqgZWXZgIxkK7TuE/C43P3DLYNC/hbpdfZPXk="><link rel=preload href=/lib/fontawesome-free/all.min.320d572dfb844e7152480b7b62374236c4896ccca3ac9d69bb03f3bc2034acb8.css integrity="sha256-Mg1XLfuETnFSSAt7YjdCNsSJbMyjrJ1puwPzvCA0rLg=" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.320d572dfb844e7152480b7b62374236c4896ccca3ac9d69bb03f3bc2034acb8.css integrity="sha256-Mg1XLfuETnFSSAt7YjdCNsSJbMyjrJ1puwPzvCA0rLg="></noscript><link rel=preload href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/liangml.github.io\/","inLanguage":"zh-CN","author":{"@type":"Person","name":"Leon"},"description":"运维小站，分享些技术经验。","image":"https:\/\/liangml.github.io\/favicon.ico","thumbnailUrl":"https:\/\/liangml.github.io\/favicon-32x32.png","name":"LEON BLOG"}</script><script src=/js/head/color-scheme.min.15fc6d693c4ea1331dfdbe98e8c76402340195b0a3b4047378cec39b7c827bfa.js integrity="sha256-FfxtaTxOoTMd/b6Y6MdkAjQBlbCjtARzeM7Dm3yCe/o="></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/ title="LEON BLOG"><img loading=lazy src=/logo.png alt="LEON BLOG" data-title="LEON BLOG" width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Kylin Blog</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/archives/><i class="fa-solid fa-feather fa-fw fa-sm" aria-hidden=true></i> 文章</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="LEON BLOG"><img loading=lazy src=/logo.png alt="LEON BLOG" data-title="LEON BLOG" width=26 height=26 class=logo style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>Kylin Blog</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/archives/><i class="fa-solid fa-feather fa-fw fa-sm" aria-hidden=true></i> 文章</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/collections/><i class="fa-solid fa-layer-group fa-fw fa-sm" aria-hidden=true></i> 合集</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li></ul></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><div class="page home posts"><div class=home-profile><div class=home-avatar><a href=/archives/ title=文章><img loading=lazy src=/avatar.jpg alt=Leon data-title=Leon width=96 height=96 style="background:url(/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></div><h1 class=home-title>LEON BLOG</h1><p class=home-subtitle><span class=d-none>劫就劫皇纲，嫖就嫖娘娘！</span><span class=typeit><template>劫就劫皇纲，嫖就嫖娘娘！</template></span></p><div class=links><a href=https://github.com/liangml title=GitHub target=_blank rel="external nofollow noopener noreferrer me"><i class="fa-brands fa-github-alt fa-fw" aria-hidden=true></i>
</a><a href=/index.xml title=RSS target=_blank rel="external nofollow noopener noreferrer me"><i class="fa-solid fa-rss fa-fw" aria-hidden=true></i></a></div></div><article class="single summary" itemscope itemtype=http://schema.org/Article><h2 class=single-title itemprop="name headline"><a href=/posts/letsencrypt/>Letsencrypt</a></h2><div class=post-meta><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span>&nbsp;<span class=post-publish title='2024-10-17 18:15:32'>发布于 <time datetime=2024-10-17>2024-10-17</time></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/https/ class=post-category title="分类 - Https"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Https</a> 和 <a href=/collections/system/ class=post-collection title="合集 - System"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> System</a></span></div><div class=content><h3 id=ssl class=heading-element><span>ssl</span>
<a href=#ssl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># acme.sh </span>
</span></span><span class=line><span class=cl><span class=c1># 默认是zerossl，存在认证问题：get authz objec with invalid status, please try again later.</span>
</span></span><span class=line><span class=cl><span class=c1># https://github.com/acmesh-official/acme.sh/wiki/Server</span>
</span></span><span class=line><span class=cl>acme.sh --set-default-ca --server letsencrypt
</span></span><span class=line><span class=cl><span class=c1># 申明dns的aksk</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>DP_Id</span><span class=o>=</span><span class=s2>&#34;xxx&#34;</span><span class=p>;</span><span class=nb>export</span> <span class=nv>DP_Key</span><span class=o>=</span><span class=s2>&#34;xxx&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 生成需要的泛域名证书</span>
</span></span><span class=line><span class=cl>acme.sh --dnssleep --force --issue -k <span class=m>2048</span> --dns dns_dp -d <span class=s1>&#39;*.exsample.com&#39;</span> -d exsample.com
</span></span><span class=line><span class=cl><span class=c1># 生成nginx 证书</span>
</span></span><span class=line><span class=cl>acme.sh --force --install-cert -d *.xxx.net <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--key-file /usr/local/openresty/nginx/conf/ssl/xxx.net.key <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--fullchain-file /usr/local/openresty/nginx/conf/ssl/xxx.net.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--reloadcmd <span class=s2>&#34;nginx -s reload&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 删除证书</span>
</span></span><span class=line><span class=cl>acme.sh --remove -d *.exsample.com
</span></span><span class=line><span class=cl><span class=c1># 查看证书信息</span>
</span></span><span class=line><span class=cl>acme.sh --info -d *.exsample.com
</span></span><span class=line><span class=cl><span class=c1># 查看证书列表</span>
</span></span><span class=line><span class=cl>acme.sh --list
</span></span><span class=line><span class=cl><span class=c1># 设置自动更新</span>
</span></span><span class=line><span class=cl>acme.sh --upgrade --auto-upgrade</span></span></code></pre></td></tr></table></div></div><h3 id=certbot class=heading-element><span>certbot</span>
<a href=#certbot class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>certbot certonly --manual  --preferred-challenges dns</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer><a href=/posts/letsencrypt/>阅读全文</a><div class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/https/ class=post-tag>Https</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h2 class=single-title itemprop="name headline"><a href=/posts/linux/>Linux</a></h2><div class=post-meta><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span>&nbsp;<span class=post-publish title='2024-10-17 18:13:34'>发布于 <time datetime=2024-10-17>2024-10-17</time></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/linux/ class=post-category title="分类 - Linux"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Linux</a> 和 <a href=/collections/system/ class=post-collection title="合集 - System"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> System</a></span></div><div class=content><h3 id=mem-centos65 class=heading-element><span>mem centos6.5</span>
<a href=#mem-centos65 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>-/+ buffers/cache：
</span></span><span class=line><span class=cl>-buffers/cache 的内存数：95 (等于第1行的 used - buffers - cached)
</span></span><span class=line><span class=cl>+buffers/cache 的内存数: 32 (等于第1行的 free + buffers + cached)
</span></span><span class=line><span class=cl>1. -buffers/cache 反映的是被程序实实在在吃掉的内存，
</span></span><span class=line><span class=cl>2. +buffers/cache 反映的是可以挪用的内存总数。</span></span></code></pre></td></tr></table></div></div><h3 id=linux-ctrl-c无效 class=heading-element><span>Linux Ctrl C无效</span>
<a href=#linux-ctrl-c%e6%97%a0%e6%95%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>原因：rvm 版本bug
</span></span><span class=line><span class=cl>解决方法：
</span></span><span class=line><span class=cl>命令查看：
</span></span><span class=line><span class=cl>    正常：
</span></span><span class=line><span class=cl>            [root@server002 ~]# trap
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGTSTP
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGTTIN
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGTTOU
</span></span><span class=line><span class=cl>    异常：
</span></span><span class=line><span class=cl>            [root@server002 ~]# trap
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGTSTP
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGTTIN
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGTTOU
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGINT
</span></span><span class=line><span class=cl>            trap -- &#39;&#39; SIGQUIT
</span></span><span class=line><span class=cl>       现象：终端Ctrl + C完全失效，当执行trap 信号命令时多处两个SIGINT和SIGQUIT两项
</span></span><span class=line><span class=cl>升级rvm 版本：rvm get stable（
</span></span><span class=line><span class=cl>1.29.4
</span></span><span class=line><span class=cl>版本以上都可以解决）
</span></span><span class=line><span class=cl>卸载rvm工具：gem uninstall rvm</span></span></code></pre></td></tr></table></div></div><h3 id=pip class=heading-element><span>pip</span>
<a href=#pip class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>国内源临时加速</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install markdown -i &lt;https://pypi.tuna.tsinghua.edu.cn/simple&gt;</span></span></code></pre></td></tr></table></div></div><ul><li>永久配置</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 清华源</span>
</span></span><span class=line><span class=cl>pip config <span class=nb>set</span> global.index-url &lt;https://pypi.tuna.tsinghua.edu.cn/simple&gt;
</span></span><span class=line><span class=cl><span class=c1># 或：</span>
</span></span><span class=line><span class=cl><span class=c1># 阿里源</span>
</span></span><span class=line><span class=cl>pip config <span class=nb>set</span> global.index-url &lt;https://mirrors.aliyun.com/pypi/simple/&gt;
</span></span><span class=line><span class=cl><span class=c1># 腾讯源</span>
</span></span><span class=line><span class=cl>pip config <span class=nb>set</span> global.index-url &lt;http://mirrors.cloud.tencent.com/pypi/simple&gt;</span></span></code></pre></td></tr></table></div></div><h3 id=goaccess class=heading-element><span>goaccess</span>
<a href=#goaccess class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h3 id=conda class=heading-element><span>conda</span>
<a href=#conda class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>• 安装uwsgi：
</span></span><span class=line><span class=cl>conda install -c conda-forge uwsgi
</span></span><span class=line><span class=cl><span class=c1># 取消自动进入base环境</span>
</span></span><span class=line><span class=cl>conda config --set auto_activate_base false</span></span></code></pre></td></tr></table></div></div><h3 id=lvm class=heading-element><span>lvm</span>
<a href=#lvm class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>lvm
</span></span><span class=line><span class=cl>pvcreate /dev/vdc
</span></span><span class=line><span class=cl>vgextend VolGroup /dev/vdc
</span></span><span class=line><span class=cl>lvextend -l +100%FREE /dev/mapper/VolGroup-LogVol00
</span></span><span class=line><span class=cl>resize2fs /dev/mapper/VolGroup-LogVol00</span></span></code></pre></td></tr></table></div></div><h3 id=根据日期排序删除 class=heading-element><span>根据日期排序删除</span>
<a href=#%e6%a0%b9%e6%8d%ae%e6%97%a5%e6%9c%9f%e6%8e%92%e5%ba%8f%e5%88%a0%e9%99%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>ls -ltd FilePath | awk &#39;{if(NR&gt;10){print $0}}&#39; | xargs rm -rf;</span></span></code></pre></td></tr></table></div></div><h3 id=磁盘在线扩容 class=heading-element><span>磁盘在线扩容</span>
<a href=#%e7%a3%81%e7%9b%98%e5%9c%a8%e7%ba%bf%e6%89%a9%e5%ae%b9 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>安装工具包：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum  -y install cloud-utils-growpart</span></span></code></pre></td></tr></table></div></div><ul><li>给指定分区扩容：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>growpart /dev/vda <span class=m>1</span></span></span></code></pre></td></tr></table></div></div><ul><li>扩容支文件系统（如果无法resize，确保分区已扩容的情况下重启服务器离线扩容）：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>resize2fs /dev/vda1</span></span></code></pre></td></tr></table></div></div><h3 id=timewait查看 class=heading-element><span>timewait查看</span>
<a href=#timewait%e6%9f%a5%e7%9c%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>netstat -an | awk &#39;{print $6}&#39; | sort | uniq -c | sort -nr</span></span></code></pre></td></tr></table></div></div><h3 id=路由新增删除 class=heading-element><span>路由新增删除</span>
<a href=#%e8%b7%af%e7%94%b1%e6%96%b0%e5%a2%9e%e5%88%a0%e9%99%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>route add -net  106.15.100.0/24   gw 183.57.42.65
</span></span><span class=line><span class=cl>route del -net  106.15.100.0/24   gw 183.57.42.65</span></span></code></pre></td></tr></table></div></div><h3 id=maildrop删除 class=heading-element><span>maildrop删除</span>
<a href=#maildrop%e5%88%a0%e9%99%a4 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>rsync  --delete -rlptD /tmp/empty/ /var/spool/postfix/maildrop/</span></span></code></pre></td></tr></table></div></div><h3 id=ssh-config class=heading-element><span>ssh config</span>
<a href=#ssh-config class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>ServerAliveInterval 60
</span></span><span class=line><span class=cl>ServerAliveCountMax 30
</span></span><span class=line><span class=cl>HostkeyAlgorithms +ssh-rsa
</span></span><span class=line><span class=cl>PubkeyAcceptedAlgorithms +ssh-rsa
</span></span><span class=line><span class=cl>UserKnownHostsFile=/dev/null
</span></span><span class=line><span class=cl>StrictHostKeyChecking no
</span></span><span class=line><span class=cl>UserKnownHostsFile=/dev/null</span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>Host *
</span></span><span class=line><span class=cl> ServerAliveInterval 60
</span></span><span class=line><span class=cl> ServerAliveCountMax 30
</span></span><span class=line><span class=cl> HostkeyAlgorithms +ssh-rsa
</span></span><span class=line><span class=cl> PubkeyAcceptedAlgorithms +ssh-rsa
</span></span><span class=line><span class=cl> StrictHostKeyChecking no</span></span></code></pre></td></tr></table></div></div><hr><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Host IPADDRESS
</span></span><span class=line><span class=cl>    HostName IPADDRESS
</span></span><span class=line><span class=cl>    User root
</span></span><span class=line><span class=cl>    IdentityFile    ~/.ssh/id_rsa</span></span></code></pre></td></tr></table></div></div><h3 id=crontab-使用vim编辑 class=heading-element><span>crontab 使用vim编辑</span>
<a href=#crontab-%e4%bd%bf%e7%94%a8vim%e7%bc%96%e8%be%91 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>  1.对于一些系统，crontab的默认编译器使用起来不是很方便，想换成熟悉的vim，按下面操作即可：编辑.profile文件，增加EDITOR=vim;export EDITOR即可；
</span></span><span class=line><span class=cl>  2.在命令行直接输入EDITOR=vim;export EDITOR</span></span></code></pre></td></tr></table></div></div><h3 id=ossutil class=heading-element><span>ossutil</span>
<a href=#ossutil class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>/opt/ossutil64 cp xxx.sql.gz oss://BUCKET/dir/ -u -c CONFIGFILE</span></span></code></pre></td></tr></table></div></div><h3 id=多线程压缩-pigz class=heading-element><span>多线程压缩 pigz</span>
<a href=#%e5%a4%9a%e7%ba%bf%e7%a8%8b%e5%8e%8b%e7%bc%a9-pigz class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl># 压缩文件
</span></span><span class=line><span class=cl>pigz -k filename # -k 保留原文件
</span></span><span class=line><span class=cl>pigz -l filename.gz # -l 查看文件压缩内容
</span></span><span class=line><span class=cl># 压缩目录
</span></span><span class=line><span class=cl>tar --use-compress-program=&#34;pigz -k&#34; -cvf dir1.tar.gz dir1
</span></span><span class=line><span class=cl># 解压文件
</span></span><span class=line><span class=cl>pigz -k -d filename.gz
</span></span><span class=line><span class=cl># 解压目录
</span></span><span class=line><span class=cl>tar --use-compress-program=&#34;pigz -k &#34; -xvf dir1.tar.gz</span></span></code></pre></td></tr></table></div></div><h3 id=requirements-依赖生成 class=heading-element><span>requirements 依赖生成:</span>
<a href=#requirements-%e4%be%9d%e8%b5%96%e7%94%9f%e6%88%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pipreqs --encoding utf8 --force</span></span></code></pre></td></tr></table></div></div><h3 id=openssl class=heading-element><span>openssl</span>
<a href=#openssl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>证书测试</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl s_client -connect domainName:443</span></span></code></pre></td></tr></table></div></div><h3 id=强密码生成 class=heading-element><span>强密码生成</span>
<a href=#%e5%bc%ba%e5%af%86%e7%a0%81%e7%94%9f%e6%88%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl rand -base64 <span class=m>15</span></span></span></code></pre></td></tr></table></div></div><ul><li>系统使用规范(自有服务统一授权为普通用户权限)<ul><li>统一数据目录：/data</li><li>统一日志目录：/var/log</li><li>应用统一管理工具：supervisor</li><li>三方应用目录：/opt</li><li>示例服务标记：<em>应用目录：application 应用备份：appbak 公共脚本：scripts</em></li></ul></li></ul></div><div class=post-footer><a href=/posts/linux/>阅读全文</a><div class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/system/ class=post-tag>System</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h2 class=single-title itemprop="name headline"><a href=/posts/supervisor/>Supervisor</a></h2><div class=post-meta><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span>&nbsp;<span class=post-publish title='2024-10-15 19:26:44'>发布于 <time datetime=2024-10-15>2024-10-15</time></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/supervisor/ class=post-category title="分类 - Supervisor"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Supervisor</a> 和 <a href=/collections/system/ class=post-collection title="合集 - System"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> System</a></span></div><div class=content><ul><li>/etc/supervisor.conf</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>unix_http_server<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>file</span><span class=o>=</span>/tmp/supervisor.sock
</span></span><span class=line><span class=cl><span class=o>[</span>supervisord<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>minfds</span><span class=o>=</span><span class=m>65535</span> <span class=c1># supervisord 加大应用的可用链接数</span>
</span></span><span class=line><span class=cl><span class=nv>minprocs</span><span class=o>=</span><span class=m>65535</span>
</span></span><span class=line><span class=cl><span class=nv>user</span><span class=o>=</span>deploy
</span></span><span class=line><span class=cl><span class=o>[</span>supervisorctl<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>serverurl</span><span class=o>=</span>unix:///tmp/supervisor.sock</span></span></code></pre></td></tr></table></div></div><ul><li>supervisor exsample</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>program:SERVICENAME<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=p>;</span>脚本目录
</span></span><span class=line><span class=cl><span class=nv>directory</span><span class=o>=</span> /data/%<span class=o>(</span>program_name<span class=o>)</span>s/
</span></span><span class=line><span class=cl><span class=p>;</span>脚本执行命令
</span></span><span class=line><span class=cl><span class=nv>command</span><span class=o>=</span>/usr/bin/uwsgi --ini %<span class=o>(</span>program_name<span class=o>)</span>s.ini --ignore-sigpipe
</span></span><span class=line><span class=cl><span class=p>;</span>supervisor启动的时候是否随着同时启动,默认True
</span></span><span class=line><span class=cl><span class=nv>autostart</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=p>;</span>当程序exit的时候，这个program不会自动重启.
</span></span><span class=line><span class=cl><span class=nv>autorestart</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=p>;</span>这个选项是子进程启动多少秒之后，此时状态如果是running，则我们认为启动成功了。默认值为1
</span></span><span class=line><span class=cl><span class=nv>startsecs</span><span class=o>=</span><span class=m>5</span>
</span></span><span class=line><span class=cl><span class=p>;</span>脚本运行的用户身份
</span></span><span class=line><span class=cl><span class=nv>user</span> <span class=o>=</span> USER
</span></span><span class=line><span class=cl><span class=p>;</span>日志输出
</span></span><span class=line><span class=cl><span class=nv>stdout_logfile</span><span class=o>=</span> /var/log/supervisor/%<span class=o>(</span>program_name<span class=o>)</span>s.log
</span></span><span class=line><span class=cl><span class=p>;</span>把stderr重定向到stdout，默认 <span class=nb>false</span>
</span></span><span class=line><span class=cl><span class=nv>redirect_stderr</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=p>;</span>stdout日志文件大小，默认 50MB
</span></span><span class=line><span class=cl><span class=nv>stdout_logfile_maxbytes</span> <span class=o>=</span> 20MB
</span></span><span class=line><span class=cl><span class=p>;</span>stdout日志文件备份数
</span></span><span class=line><span class=cl><span class=nv>stdout_logfile_backups</span> <span class=o>=</span> <span class=m>20</span>
</span></span><span class=line><span class=cl><span class=p>;</span><span class=nv>environment</span><span class=o>=</span></span></span></code></pre></td></tr></table></div></div></div><div class=post-footer><a href=/posts/supervisor/>阅读全文</a><div class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/supervisor/ class=post-tag>Supervisor</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h2 class=single-title itemprop="name headline"><a href=/posts/openvpncommunity/>OpenvpnCommunity</a></h2><div class=post-meta><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span>&nbsp;<span class=post-publish title='2024-10-15 19:25:44'>发布于 <time datetime=2024-10-15>2024-10-15</time></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/openvpn/ class=post-category title="分类 - Openvpn"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Openvpn</a> 和 <a href=/collections/services/ class=post-collection title="合集 - Services"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Services</a></span></div><div class=content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>port <span class=m>2305</span>
</span></span><span class=line><span class=cl>proto udp
</span></span><span class=line><span class=cl>dev tun
</span></span><span class=line><span class=cl>ca ca.crt
</span></span><span class=line><span class=cl>cert server.crt
</span></span><span class=line><span class=cl>key server.key
</span></span><span class=line><span class=cl>dh dh.pem
</span></span><span class=line><span class=cl>auth SHA512
</span></span><span class=line><span class=cl>tls-crypt tc.key
</span></span><span class=line><span class=cl>topology subnet
</span></span><span class=line><span class=cl>server 10.8.0.0 255.255.255.0
</span></span><span class=line><span class=cl>ifconfig-pool-persist ipp.txt
</span></span><span class=line><span class=cl>push <span class=s2>&#34;dhcp-option DNS 100.100.2.136&#34;</span>
</span></span><span class=line><span class=cl>push <span class=s2>&#34;dhcp-option DNS 100.100.2.138&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 内网推送</span>
</span></span><span class=line><span class=cl>push <span class=s2>&#34;route 172.16.0.0 255.255.0.0&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 阿里内网推送</span>
</span></span><span class=line><span class=cl>push <span class=s2>&#34;route 100.100.0.0 255.255.0.0&#34;</span>
</span></span><span class=line><span class=cl>push <span class=s2>&#34;route 100.103.0.0 255.255.0.0&#34;</span>
</span></span><span class=line><span class=cl>push <span class=s2>&#34;route 47.106.223.210 255.255.255.255&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>keepalive <span class=m>10</span> <span class=m>120</span>
</span></span><span class=line><span class=cl>cipher AES-256-CBC
</span></span><span class=line><span class=cl>user nobody
</span></span><span class=line><span class=cl>group nobody
</span></span><span class=line><span class=cl>persist-key
</span></span><span class=line><span class=cl>persist-tun
</span></span><span class=line><span class=cl>verb <span class=m>3</span>
</span></span><span class=line><span class=cl>crl-verify crl.pem
</span></span><span class=line><span class=cl>explicit-exit-notify</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer><a href=/posts/openvpncommunity/>阅读全文</a><div class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/openvpn/ class=post-tag>Openvpn</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h2 class=single-title itemprop="name headline"><a href=/posts/nginx/>Nginx</a></h2><div class=post-meta><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span>&nbsp;<span class=post-publish title='2024-10-15 19:25:10'>发布于 <time datetime=2024-10-15>2024-10-15</time></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/nginx/ class=post-category title="分类 - Nginx"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Nginx</a> 和 <a href=/collections/services/ class=post-collection title="合集 - Services"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Services</a></span></div><div class=content><h3 id=请求方法限制 class=heading-element><span>请求方法限制</span>
<a href=#%e8%af%b7%e6%b1%82%e6%96%b9%e6%b3%95%e9%99%90%e5%88%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=nv>$request_method</span> !~ ^<span class=o>(</span>GET<span class=p>|</span>HEAD<span class=p>|</span>POST<span class=o>)</span>$ <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> 501<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=try_files class=heading-element><span>try_files</span>
<a href=#try_files class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    try_files <span class=nv>$uri</span> <span class=nv>$uri</span>/ /index.html<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><hr><ul><li>next.js</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    try_files <span class=nv>$uri</span> <span class=nv>$uri</span>.html <span class=nv>$uri</span>/ /index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=443-force-ssl class=heading-element><span>443 force ssl</span>
<a href=#443-force-ssl class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$ssl_protocol</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=m>302</span> https://<span class=nv>$host$request_uri</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>or
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$server_port</span> !~ 443<span class=o>)</span> <span class=o>{</span> rewrite ^<span class=o>(</span>.*<span class=o>)</span>$ https://<span class=nv>$host$1</span> redirect<span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>or
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$server_port</span> !~ 443<span class=o>)</span> <span class=o>{</span> rewrite ^<span class=o>(</span>.*<span class=o>)</span>$ https://<span class=nv>$host$1</span> permanent<span class=p>;</span> <span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=499 class=heading-element><span>499</span>
<a href=#499 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>proxy_ignore_client_abort on<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 确定在客户端关闭连接时是否应关闭与代理服务器的连接，而不在等待响应</span>
</span></span><span class=line><span class=cl>proxy_read_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>proxy_send_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># 如果超时(默认60s)，Nginx 会主动断开连接，记录504</span></span></span></code></pre></td></tr></table></div></div><h3 id=log-format class=heading-element><span>log format</span>
<a href=#log-format class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>log_format main  <span class=nv>escape</span><span class=o>=</span>json <span class=s1>&#39;{ &#34;time_local&#34;: &#34;$time_local&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;remote_user&#34;: &#34;$remote_user&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;remote_addr&#34;: &#34;$remote_addr&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_referer&#34;: &#34;$http_referer&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;request&#34;: &#34;$request&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;method&#34;: &#34;$request_method&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;url_path&#34;: &#34;$request_uri&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;request_body&#34;: &#34;$request_body&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;status&#34;: $status, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;level&#34;: &#34;$level&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;body_bytes_sent&#34;: $body_bytes_sent, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_user_agent&#34;: &#34;$http_user_agent&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_host&#34;: &#34;$http_host&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_requestid&#34;: &#34;$http_requestid&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_authorization&#34;: &#34;$http_authorization&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;business&#34;: &#34;ngx_access-$host&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;http_x_forwarded_for&#34;: &#34;$http_x_forwarded_for&#34;, &#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;upstream_addr&#34;: &#34;$upstream_addr&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;trace_id&#34;: &#34;$trace_id&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;upstream_response_time&#34;: &#34;$upstream_response_timer&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;ssl_protocol&#34;: &#34;$ssl_protocol&#34;,&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;&#34;request_time&#34;: $request_time&#39;</span>
</span></span><span class=line><span class=cl>                        <span class=s1>&#39; }&#39;</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h3 id=跨域 class=heading-element><span>跨域</span>
<a href=#%e8%b7%a8%e5%9f%9f class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>add_header Access-Control-Allow-Origin *<span class=p>;</span>
</span></span><span class=line><span class=cl>add_header Access-Control-Allow-Methods *<span class=p>;</span>
</span></span><span class=line><span class=cl>add_header Access-Control-Allow-Credentials true<span class=p>;</span></span></span></code></pre></td></tr></table></div></div><h3 id=上传文件 class=heading-element><span>上传文件</span>
<a href=#%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># nginx
</span></span><span class=line><span class=cl>client_max_body_size 1024m;</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># php
</span></span><span class=line><span class=cl>file_uploads on        是否允许通过HTTP上传文件的开关。
</span></span><span class=line><span class=cl>默认为ON即是开upload_tmp_dir – 文件上传至服务器上存储临时文件的地方，如果没指定就会用系统默认的临时文件夹
</span></span><span class=line><span class=cl>upload_max_filesize 8m 望文生意，即允许上传文件大小的最大值。默认为2M
</span></span><span class=line><span class=cl>post_max_size 8m       指通过表单POST给PHP的所能接收的最大值，包括表单里的所有值。默认为8M
</span></span><span class=line><span class=cl># 针对网络不好配置
</span></span><span class=line><span class=cl>max_execution_time 600  每个PHP页面运行的最大时间值(秒)，默认30秒
</span></span><span class=line><span class=cl>max_input_time 600      每个PHP页面接收数据所需的最大时间，默认60秒
</span></span><span class=line><span class=cl>memory_limit 8m         每个PHP页面所吃掉的最大内存，默认8M</span></span></code></pre></td></tr></table></div></div><h3 id=proxy class=heading-element><span>proxy</span>
<a href=#proxy class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>location ~ .*\.(js|css)?$ {
</span></span><span class=line><span class=cl>	expires 12h;
</span></span><span class=line><span class=cl>	proxy_pass http://xxx;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)?$ {
</span></span><span class=line><span class=cl>	expires 12h;
</span></span><span class=line><span class=cl>	proxy_pass http://xxx;
</span></span><span class=line><span class=cl>}</span></span></code></pre></td></tr></table></div></div><h3 id=exsample class=heading-element><span>exsample</span>
<a href=#exsample class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><h4 id=http class=heading-element><span>http</span>
<a href=#http class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>upstream xxx.cn <span class=o>{</span>
</span></span><span class=line><span class=cl>	server  10.x:3000  <span class=nv>weight</span><span class=o>=</span><span class=m>10</span> <span class=nv>max_fails</span><span class=o>=</span><span class=m>3</span> <span class=nv>fail_timeout</span><span class=o>=</span>3s<span class=p>;</span>
</span></span><span class=line><span class=cl>	server  10.x:3000  <span class=nv>weight</span><span class=o>=</span><span class=m>10</span> <span class=nv>max_fails</span><span class=o>=</span><span class=m>3</span> <span class=nv>fail_timeout</span><span class=o>=</span>3s<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 	check <span class=nv>interval</span><span class=o>=</span><span class=m>1000</span> <span class=nv>rise</span><span class=o>=</span><span class=m>2</span> <span class=nv>fall</span><span class=o>=</span><span class=m>3</span> <span class=nv>timeout</span><span class=o>=</span><span class=m>5000</span> <span class=nv>type</span><span class=o>=</span>http <span class=nv>default_down</span><span class=o>=</span>false<span class=p>;</span>
</span></span><span class=line><span class=cl> 	check_http_send <span class=s2>&#34;GET /ping HTTP/1.0\\r\\n\\r\\n&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 	check_http_expect_alive http_2xx http_3xx<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>	listen	80<span class=p>;</span>
</span></span><span class=line><span class=cl>	server_name  xxx.cn<span class=p>;</span>
</span></span><span class=line><span class=cl>	index index.html index.htm<span class=p>;</span>
</span></span><span class=line><span class=cl>	access_log  /var/log/nginx/xxx.cn.access.log  main<span class=p>;</span>
</span></span><span class=line><span class=cl>	error_log   /var/log/nginx/xxx.cn.error.log warn<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	location ~ ^/NginxStatus/ <span class=o>{</span>
</span></span><span class=line><span class=cl>			stub_status on<span class=p>;</span>
</span></span><span class=line><span class=cl>			access_log on<span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	location / <span class=o>{</span>
</span></span><span class=line><span class=cl>		proxy_redirect off <span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header Host <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header X-Real-IP <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header REMOTE-HOST <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_set_header X-Forwarded-For <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_connect_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_send_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_read_timeout 600<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_ignore_client_abort on<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_buffer_size 1600k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_buffers <span class=m>4</span> 3200k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_busy_buffers_size 6400k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_temp_file_write_size 6400k<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_max_temp_file_size 128m<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_next_upstream error timeout invalid_header http_500 http_503 http_404<span class=p>;</span>
</span></span><span class=line><span class=cl>		proxy_pass	http://xxx.cn<span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h4 id=php class=heading-element><span>php</span>
<a href=#php class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>listen <span class=o>[</span>::<span class=o>]</span>:80<span class=p>;</span>
</span></span><span class=line><span class=cl>listen <span class=m>443</span> ssl http2<span class=p>;</span>
</span></span><span class=line><span class=cl>listen <span class=o>[</span>::<span class=o>]</span>:443 ssl http2<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_certificate /usr/local/openresty/nginx/conf/ssl/xxx.com.pem<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_certificate_key /usr/local/openresty/nginx/conf/ssl/xxx.com.key<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_protocols TLSv1.2 TLSv1.3<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_ecdh_curve X25519:prime256v1:secp384r1:secp521r1<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_conf_command Ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_conf_command Options PrioritizeChaCha<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_prefer_server_ciphers on<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_session_timeout 10m<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_session_cache shared:SSL:10m<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_buffer_size 2k<span class=p>;</span>
</span></span><span class=line><span class=cl>add_header Strict-Transport-Security max-age<span class=o>=</span>15768000<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_stapling on<span class=p>;</span>
</span></span><span class=line><span class=cl>ssl_stapling_verify on<span class=p>;</span>
</span></span><span class=line><span class=cl>server_name xxx<span class=p>;</span>
</span></span><span class=line><span class=cl>access_log /var/log/xxx.log combined<span class=p>;</span>
</span></span><span class=line><span class=cl>index index.html index.htm index.php<span class=p>;</span>
</span></span><span class=line><span class=cl>root xxx_path<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=nv>$ssl_protocol</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=m>302</span> https://<span class=nv>$host$request_uri</span><span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ <span class=o>[</span>^/<span class=o>]</span><span class=se>\\</span>.php<span class=o>(</span>/<span class=p>|</span>$<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>#fastcgi_pass remote_php_ip:9000;</span>
</span></span><span class=line><span class=cl>  fastcgi_pass unix:/dev/shm/php-cgi.sock<span class=p>;</span>
</span></span><span class=line><span class=cl>  fastcgi_index index.php<span class=p>;</span>
</span></span><span class=line><span class=cl>  include fastcgi.conf<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ .*<span class=se>\\</span>.<span class=o>(</span>gif<span class=p>|</span>jpg<span class=p>|</span>jpeg<span class=p>|</span>png<span class=p>|</span>bmp<span class=p>|</span>swf<span class=p>|</span>flv<span class=p>|</span>mp4<span class=p>|</span>ico<span class=o>)</span>$ <span class=o>{</span>
</span></span><span class=line><span class=cl>  expires 30d<span class=p>;</span>
</span></span><span class=line><span class=cl>  access_log off<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ .*<span class=se>\\</span>.<span class=o>(</span>js<span class=p>|</span>css<span class=o>)</span>?$ <span class=o>{</span>
</span></span><span class=line><span class=cl>  expires 7d<span class=p>;</span>
</span></span><span class=line><span class=cl>  access_log off<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location ~ /<span class=o>(</span><span class=se>\\</span>.user<span class=se>\\</span>.ini<span class=p>|</span><span class=se>\\</span>.ht<span class=p>|</span><span class=se>\\</span>.git<span class=p>|</span><span class=se>\\</span>.svn<span class=p>|</span><span class=se>\\</span>.project<span class=p>|</span>LICENSE<span class=p>|</span>README<span class=se>\\</span>.md<span class=p>|</span><span class=se>\\</span>.env<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  deny all<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>location /.well-known <span class=o>{</span>
</span></span><span class=line><span class=cl>  allow all<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></td></tr></table></div></div><h3 id=default_server class=heading-element><span>default_server</span>
<a href=#default_server class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># 手动生成本地ssl公私钥
</span></span><span class=line><span class=cl>openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 增加default_server
</span></span><span class=line><span class=cl>cat &lt;&lt; &#39;EOF&#39; &gt; /etc/nginx/sites-available/000_default
</span></span><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen 80 default_server;
</span></span><span class=line><span class=cl>    listen 443 ssl default_server;
</span></span><span class=line><span class=cl>    ssl_certificate        /etc/nginx/ssl/nginx.crt;
</span></span><span class=line><span class=cl>    ssl_certificate_key    /etc/nginx/ssl/nginx.key;
</span></span><span class=line><span class=cl>    server_name _;
</span></span><span class=line><span class=cl>    return 444;
</span></span><span class=line><span class=cl>    access_log /var/log/nginx/000_default.access.log;
</span></span><span class=line><span class=cl>    error_log /var/log/nginx/000_default.error.log;
</span></span><span class=line><span class=cl>} 
</span></span><span class=line><span class=cl>EOF
</span></span><span class=line><span class=cl># reload nginx
</span></span><span class=line><span class=cl>nginx -t
</span></span><span class=line><span class=cl>nginx -s reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 查看日志，检查其他域名是否正常
</span></span><span class=line><span class=cl>tailf /var/log/nginx/000_default.access.log</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer><a href=/posts/nginx/>阅读全文</a><div class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/nginx/ class=post-tag>Nginx</a></div></div></article><article class="single summary" itemscope itemtype=http://schema.org/Article><h2 class=single-title itemprop="name headline"><a href=/posts/minio/>Minio</a></h2><div class=post-meta><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Leon</span></span>&nbsp;<span class=post-publish title='2024-10-15 19:24:41'>发布于 <time datetime=2024-10-15>2024-10-15</time></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/minio/ class=post-category title="分类 - Minio"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Minio</a> 和 <a href=/collections/services/ class=post-collection title="合集 - Services"><i class="fa-solid fa-layer-group fa-fw" aria-hidden=true></i> Services</a></span></div><div class=content><p>集群版条件</p><div class="alert alert-note"><p class=alert-title><svg class="icon" viewBox="0 0 16 16" width="16" height="16"><path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/></svg>注意</p><ul><li>单独无数据磁盘使用</li><li>minio节点的时间不能超过3s</li></ul></div><h3 id=nginx-配置 class=heading-element><span>nginx 配置</span>
<a href=#nginx-%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>upstream xxx.com {
</span></span><span class=line><span class=cl>   least_conn;
</span></span><span class=line><span class=cl>   server 127.0.0.1:9000;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>upstream xxx.com-console {
</span></span><span class=line><span class=cl>   least_conn;
</span></span><span class=line><span class=cl>   server 127.0.0.1:9001;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>   listen       80;
</span></span><span class=line><span class=cl>   listen  [::]:80;
</span></span><span class=line><span class=cl>   server_name  xxx.com;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   access_log  /var/log/nginx/xxx.com.access.log  main;
</span></span><span class=line><span class=cl>   error_log   /var/log/nginx/xxx.com.error.log warn;
</span></span><span class=line><span class=cl>   # Allow special characters in headers
</span></span><span class=line><span class=cl>   ignore_invalid_headers off;
</span></span><span class=line><span class=cl>   # Allow any size file to be uploaded.
</span></span><span class=line><span class=cl>   # Set to a value such as 1000m; to restrict file size to a specific value
</span></span><span class=line><span class=cl>   client_max_body_size 0;
</span></span><span class=line><span class=cl>   # Disable buffering
</span></span><span class=line><span class=cl>   proxy_buffering off;
</span></span><span class=line><span class=cl>   proxy_request_buffering off;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   location / {
</span></span><span class=line><span class=cl>      proxy_set_header Host $http_host;
</span></span><span class=line><span class=cl>      proxy_set_header X-Real-IP $remote_addr;
</span></span><span class=line><span class=cl>      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span class=line><span class=cl>      proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      proxy_connect_timeout 300;
</span></span><span class=line><span class=cl>      # Default is HTTP/1, keepalive is only enabled in HTTP/1.1
</span></span><span class=line><span class=cl>      proxy_http_version 1.1;
</span></span><span class=line><span class=cl>      proxy_set_header Connection &#34;&#34;;
</span></span><span class=line><span class=cl>      chunked_transfer_encoding off;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      proxy_pass &lt;http://xxx.com&gt;; # This uses the upstream directive definition to load balance
</span></span><span class=line><span class=cl>   }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   location /minio {
</span></span><span class=line><span class=cl>      proxy_set_header Host $http_host;
</span></span><span class=line><span class=cl>      proxy_set_header X-Real-IP $remote_addr;
</span></span><span class=line><span class=cl>      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span class=line><span class=cl>      proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span class=line><span class=cl>      proxy_set_header X-NginX-Proxy true;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      # This is necessary to pass the correct IP to be hashed
</span></span><span class=line><span class=cl>      # real_ip_header X-Real-IP;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      proxy_connect_timeout 300;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      # To support websockets in MinIO versions released after January 2023
</span></span><span class=line><span class=cl>      proxy_http_version 1.1;
</span></span><span class=line><span class=cl>      proxy_set_header Upgrade $http_upgrade;
</span></span><span class=line><span class=cl>      proxy_set_header Connection &#34;upgrade&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      chunked_transfer_encoding off;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      proxy_pass &lt;http://xxx.com-console&gt;; # This uses the upstream directive definition to load balance and assumes a static Console port of 9001
</span></span><span class=line><span class=cl>   }
</span></span><span class=line><span class=cl>}</span></span></code></pre></td></tr></table></div></div><h3 id=minio-配置 class=heading-element><span>minio 配置</span>
<a href=#minio-%e9%85%8d%e7%bd%ae class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li>useradd minio -s /sbin/nologin</li><li>/etc/default/minio</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>MINIO_VOLUMES</span><span class=o>=</span><span class=s2>&#34;&lt;http://192.168.1.141/data/minio&gt; &lt;http://192.168.1.140/data/minio&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MINIO_OPTS</span><span class=o>=</span><span class=s2>&#34;--console-address :9001 --address :9000&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MINIO_ROOT_USER</span><span class=o>=</span>admin
</span></span><span class=line><span class=cl><span class=nv>MINIO_ROOT_PASSWORD</span><span class=o>=</span>xxx
</span></span><span class=line><span class=cl><span class=c1># MINIO_SERVER_URL=&#34;&lt;https://minio.example.net:9000&gt;&#34;</span></span></span></code></pre></td></tr></table></div></div><ul><li>/usr/lib/systemd/system/minio.service</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[Unit]
</span></span><span class=line><span class=cl>Description=MinIO
</span></span><span class=line><span class=cl>Documentation=https://min.io/docs/minio/linux/index.html
</span></span><span class=line><span class=cl>Wants=network-online.target
</span></span><span class=line><span class=cl>After=network-online.target
</span></span><span class=line><span class=cl>AssertFileIsExecutable=/usr/local/bin/minio
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[Service]
</span></span><span class=line><span class=cl>WorkingDirectory=/usr/local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User=minio
</span></span><span class=line><span class=cl>Group=minio
</span></span><span class=line><span class=cl>ProtectProc=invisible
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EnvironmentFile=-/etc/default/minio
</span></span><span class=line><span class=cl>ExecStartPre=/bin/bash -c &#34;if [ -z \\&#34;${MINIO_VOLUMES}\\&#34; ]; then echo \\&#34;Variable MINIO_VOLUMES not set in /etc/default/minio\\&#34;; exit 1; fi&#34;
</span></span><span class=line><span class=cl>ExecStart=/usr/local/bin/minio server $MINIO_OPTS $MINIO_VOLUMES
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># MinIO RELEASE.2023-05-04T21-44-30Z adds support for Type=notify (&lt;https://www.freedesktop.org/software/systemd/man/systemd.service.html#Type=&gt;)
</span></span><span class=line><span class=cl># This may improve systemctl setups where other services use `After=minio.server`
</span></span><span class=line><span class=cl># Uncomment the line to enable the functionality
</span></span><span class=line><span class=cl># Type=notify
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Let systemd restart this service always
</span></span><span class=line><span class=cl>Restart=always
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Specifies the maximum file descriptor number that can be opened by this process
</span></span><span class=line><span class=cl>LimitNOFILE=65536
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Specifies the maximum number of threads this process can create
</span></span><span class=line><span class=cl>TasksMax=infinity
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Disable timeout logic and wait until process is stopped
</span></span><span class=line><span class=cl>TimeoutStopSec=infinity
</span></span><span class=line><span class=cl>SendSIGKILL=no
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[Install]
</span></span><span class=line><span class=cl>WantedBy=multi-user.target
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Built for ${project.name}-${project.version} (${project.name})</span></span></code></pre></td></tr></table></div></div><ul><li>开启自启动</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 创建minio目录（一个盘对应一个目录即可）</span>
</span></span><span class=line><span class=cl>mkdir /data/minio
</span></span><span class=line><span class=cl>chown -R minio.minio /data/minio
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> minio
</span></span><span class=line><span class=cl>systemctl start minio</span></span></code></pre></td></tr></table></div></div></div><div class=post-footer><a href=/posts/minio/>阅读全文</a><div class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/minio/ class=post-tag>Minio</a></div></div></article><ul class=pagination><li class=page-item><span class=page-link><a href=/>1</a></span></li><li class="page-item active"><span class=page-link><a href=/page/2/>2</a></span></li><li class=page-item><span class=page-link><a href=/page/3/>3</a></span></li><li class=page-item><span class=page-link><a href=/page/4/>4</a></span></li><li class=page-item><span class=page-link><a href=/page/5/>5</a></span></li></ul></div></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.140.1"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.16-f66dc32e"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/>Leon</a></span><span class="license footer-divider"><a rel:"license external nofollow noopener noreferrer" href:"https://creativecommons.org/licenses/by-nc/4.0/" target:"_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/liangml title="在 GitHub 上查看源代码" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.120f067ebd6f322339e2ccccd7e87e334d7c7ea5b2bd553f325f2ae3c3ae6fe8.css integrity="sha256-Eg8Gfr1vMiM54szM1+h+M018fqWyvVU/Ml8q48Oub+g="><link rel=preload href=/lib/katex/katex.min.7e5db7914b97e596a36c1abb67ccc7f174f8bb71d38c9a88c55b262ed1737f97.css integrity="sha256-fl23kUuX5ZajbBq7Z8zH8XT4u3HTjJqIxVsmLtFzf5c=" as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.7e5db7914b97e596a36c1abb67ccc7f174f8bb71d38c9a88c55b262ed1737f97.css integrity="sha256-fl23kUuX5ZajbBq7Z8zH8XT4u3HTjJqIxVsmLtFzf5c="></noscript><script src=/lib/autocomplete/autocomplete.min.ae2da1bd62c6469ee27770ad1cddf2e8296d8a7f6d85b091463e5200c5e320af.js integrity="sha256-ri2hvWLGRp7id3CtHN3y6Cltin9thbCRRj5SAMXjIK8=" defer></script><script src=/lib/fuse/fuse.min.c57339c3fa16b1d69d9a6b46749a8139ef8d4fc9bbfe48144ff897aa7d4222ec.js integrity="sha256-xXM5w/oWsdadmmtGdJqBOe+NT8m7/kgUT/iXqn1CIuw=" defer></script><script src=/lib/lightgallery/lightgallery.min.7de2854e7954105f2b91ff5983749c4e3c7af51e05aae279f8a5d66994a85777.js integrity="sha256-feKFTnlUEF8rkf9Zg3ScTjx69R4FquJ5+KXWaZSoV3c=" defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.4fbc3ec1878e90348b71b3594d8ef27c4f10a1a4c6d5e74948d0ee59018fd87c.js integrity="sha256-T7w+wYeOkDSLcbNZTY7yfE8QoaTG1edJSNDuWQGP2Hw=" defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.821a2adb8005511c0ad9ef6f395c1b74beacc2da194cd13a4ac43d341246e085.js integrity="sha256-ghoq24AFURwK2e9vOVwbdL6swtoZTNE6SsQ9NBJG4IU=" defer></script><script src=/lib/sharer/sharer.min.ba5171a78670b031914e623431a33a3d73c1ea9897e552ba73bc2c2da7c777b9.js integrity="sha256-ulFxp4ZwsDGRTmI0MaM6PXPB6piX5VK6c7wsLafHd7k=" async defer></script><script src=/lib/typeit/index.umd.96b5f642c8fe44454a419adf52ef6949f8b3b6f071f6dff508773b5bbd6444c8.js integrity="sha256-lrX2Qsj+REVKQZrfUu9pSfiztvBx9t/1CHc7W71kRMg=" defer></script><script src=/lib/katex/katex.min.9f45307c5794ed247a0d095f3a62e52ef2215a67b2327203a7fd919959ae79d1.js integrity="sha256-n0UwfFeU7SR6DQlfOmLlLvIhWmeyMnIDp/2RmVmuedE=" defer></script><script src=/lib/katex/auto-render.min.7b57d427ac6270677daf8d8380ded2cc73336f9149a167b8e1fe0d6ef66604ae.js integrity="sha256-e1fUJ6xicGd9r42DgN7SzHMzb5FJoWe44f4NbvZmBK4=" defer></script><script src=/lib/katex/copy-tex.min.07770af90943a1de1a1010794bc78c6a7346d46d48fb63e35cc76ba76b827604.js integrity="sha256-B3cK+QlDod4aEBB5S8eManNG1G1I+2PjXMdrp2uCdgQ=" defer></script><script src=/lib/katex/mhchem.min.f0ca03df194b8c3d6017ff455db6a0ef98857905663fa311a6cded788b15340b.js integrity="sha256-8MoD3xlLjD1gF/9FXbag75iFeQVmP6MRps3teIsVNAs=" defer></script><script src=/lib/pangu/pangu.min.8feca3e7a71d118d82c2456d1b2cf5f1f3726c51a930627c2711b7192c8edbe2.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" defer></script><script src=https://vercount.one/js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},enablePWA:!0,lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},pangu:{enable:!0,selector:"article"},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2018-02-06T11:15:22+08:00",typeit:{cursorChar:"|",cursorSpeed:1e3,duration:-1,loop:!1,speed:100},version:"v0.3.16-f66dc32e"}</script><script src=/js/theme.min.0daa504da430d5723626cca1801d04ac125316adbe008489bd4ebe37d7bd9a01.js integrity="sha256-DapQTaQw1XI2JsyhgB0ErBJTFq2+AISJvU6+N9e9mgE=" defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TDTX88VL0X",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-TDTX88VL0X" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?0efb33ce4bda317225be7158a8517fd0",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>