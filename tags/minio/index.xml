<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Minio - 标签 - LEON BLOG</title><link>https://blog.liangml.dpdns.org/tags/minio/</link><description>运维小站，分享些技术经验。</description><generator>Hugo 0.156.0 &amp; FixIt v0.4.2</generator><language>zh-CN</language><lastBuildDate>Tue, 15 Oct 2024 19:24:41 +0800</lastBuildDate><atom:link href="https://blog.liangml.dpdns.org/tags/minio/index.xml" rel="self" type="application/rss+xml"/><item><title>Minio</title><link>https://blog.liangml.dpdns.org/posts/minio/</link><pubDate>Tue, 15 Oct 2024 19:24:41 +0800</pubDate><guid>https://blog.liangml.dpdns.org/posts/minio/</guid><category domain="https://blog.liangml.dpdns.org/categories/minio/">Minio</category><description>&lt;p&gt;集群版条件&lt;/p&gt;
&lt;div class="alert alert-note"&gt;&lt;p class="alert-title"&gt;&lt;svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"&gt;&lt;path d="M0 8a8 8 0 1116 0A8 8 0 010 8zm8-6.5a6.5 6.5.0 100 13 6.5 6.5.0 000-13zM6.5 7.75A.75.75.0 017.25 7h1a.75.75.0 01.75.75v2.75h.25a.75.75.0 010 1.5h-2a.75.75.0 010-1.5h.25v-2h-.25a.75.75.0 01-.75-.75zM8 6a1 1 0 110-2 1 1 0 010 2z"/&gt;&lt;/svg&gt;注意&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;单独无数据磁盘使用&lt;/li&gt;
&lt;li&gt;minio节点的时间不能超过3s&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;h2 class="heading-element" id="nginx-配置"&gt;&lt;span&gt;nginx 配置&lt;/span&gt;
 &lt;a href="#nginx-%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;upstream xxx.com {
 least_conn;
 server 127.0.0.1:9000;
}
upstream xxx.com-console {
 least_conn;
 server 127.0.0.1:9001;
}

server {
 listen 80;
 listen [::]:80;
 server_name xxx.com;

 access_log /var/log/nginx/xxx.com.access.log main;
 error_log /var/log/nginx/xxx.com.error.log warn;
 # Allow special characters in headers
 ignore_invalid_headers off;
 # Allow any size file to be uploaded.
 # Set to a value such as 1000m; to restrict file size to a specific value
 client_max_body_size 0;
 # Disable buffering
 proxy_buffering off;
 proxy_request_buffering off;

 location / {
 proxy_set_header Host $http_host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 proxy_set_header X-Forwarded-Proto $scheme;

 proxy_connect_timeout 300;
 # Default is HTTP/1, keepalive is only enabled in HTTP/1.1
 proxy_http_version 1.1;
 proxy_set_header Connection &amp;#34;&amp;#34;;
 chunked_transfer_encoding off;

 proxy_pass &amp;lt;http://xxx.com&amp;gt;; # This uses the upstream directive definition to load balance
 }

 location /minio {
 proxy_set_header Host $http_host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 proxy_set_header X-Forwarded-Proto $scheme;
 proxy_set_header X-NginX-Proxy true;

 # This is necessary to pass the correct IP to be hashed
 # real_ip_header X-Real-IP;

 proxy_connect_timeout 300;

 # To support websockets in MinIO versions released after January 2023
 proxy_http_version 1.1;
 proxy_set_header Upgrade $http_upgrade;
 proxy_set_header Connection &amp;#34;upgrade&amp;#34;;

 chunked_transfer_encoding off;

 proxy_pass &amp;lt;http://xxx.com-console&amp;gt;; # This uses the upstream directive definition to load balance and assumes a static Console port of 9001
 }
}&lt;/code&gt;&lt;/pre&gt;&lt;h2 class="heading-element" id="minio-配置"&gt;&lt;span&gt;minio 配置&lt;/span&gt;
 &lt;a href="#minio-%e9%85%8d%e7%bd%ae" class="heading-mark"&gt;
 &lt;svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"&gt;&lt;path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"&gt;&lt;/path&gt;&lt;/svg&gt;
 &lt;/a&gt;
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;useradd minio -s /sbin/nologin&lt;/li&gt;
&lt;li&gt;/etc/default/minio&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;MINIO_VOLUMES=&amp;#34;&amp;lt;http://192.168.1.141/data/minio&amp;gt; &amp;lt;http://192.168.1.140/data/minio&amp;gt;&amp;#34;
MINIO_OPTS=&amp;#34;--console-address :9001 --address :9000&amp;#34;
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=xxx
# MINIO_SERVER_URL=&amp;#34;&amp;lt;https://minio.example.net:9000&amp;gt;&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;/usr/lib/systemd/system/minio.service&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;[Unit]
Description=MinIO
Documentation=https://min.io/docs/minio/linux/index.html
Wants=network-online.target
After=network-online.target
AssertFileIsExecutable=/usr/local/bin/minio

[Service]
WorkingDirectory=/usr/local

User=minio
Group=minio
ProtectProc=invisible

EnvironmentFile=-/etc/default/minio
ExecStartPre=/bin/bash -c &amp;#34;if [ -z \\&amp;#34;${MINIO_VOLUMES}\\&amp;#34; ]; then echo \\&amp;#34;Variable MINIO_VOLUMES not set in /etc/default/minio\\&amp;#34;; exit 1; fi&amp;#34;
ExecStart=/usr/local/bin/minio server $MINIO_OPTS $MINIO_VOLUMES

# MinIO RELEASE.2023-05-04T21-44-30Z adds support for Type=notify (&amp;lt;https://www.freedesktop.org/software/systemd/man/systemd.service.html#Type=&amp;gt;)
# This may improve systemctl setups where other services use `After=minio.server`
# Uncomment the line to enable the functionality
# Type=notify

# Let systemd restart this service always
Restart=always

# Specifies the maximum file descriptor number that can be opened by this process
LimitNOFILE=65536

# Specifies the maximum number of threads this process can create
TasksMax=infinity

# Disable timeout logic and wait until process is stopped
TimeoutStopSec=infinity
SendSIGKILL=no

[Install]
WantedBy=multi-user.target

# Built for ${project.name}-${project.version} (${project.name})&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;开启自启动&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;# 创建minio目录（一个盘对应一个目录即可）
mkdir /data/minio
chown -R minio.minio /data/minio
systemctl enable minio
systemctl start minio&lt;/code&gt;&lt;/pre&gt;</description></item></channel></rss>